#+title: TimTam

This repository is an attempt to implement the [[https://github.com/aezarebski/timtam][TimTam]] likelihood as a BEAST2
package. There is a [[*Vignette][vignette]] demonstrating how to use this.

* Remaining tasks and open problems

1. AVOID USING THE SAME PACKAGE PATHS!
2. Include an example without \(\rho\)-sampling with an estimated tree.
3. Use proper dates on the nodes and point process to avoid needing to
   pre-compute these for the XML
   - The [[https://cran.r-project.org/web/packages/phangorn/index.html][phangorn]] package can simulate sequences on a tree.
   - There is a Taming the Beast [[https://taming-the-beast.org/tutorials/Molecular-Dating-Tutorial/][tutorial]] which looks at dates on nodes.
4. Make the vignette easier to run and make it easier to generate the XML from a
   dataset.
5. Include the capability to parameterise this in terms of \(R_{0}\).
6. Set up a BEAUTi template.
   - This may require reading up on how to use Swing.

* Vignette

- [[file:./doc/vignettes/fixed-tree-with-rho/README.org][Fixed tree with \(\rho\)-sample]]
- [[file:./doc/vignettes/estimated-tree-with-rho/README.org][Estimated tree with \(\rho\)-sample]]
- [[file:./doc/vignettes/fixed-tree-without-rho/README.org][Fixed tree without \(\rho\)-sample]]
- [[file:./doc/vignettes/estimated-tree-without-rho/README.org][Estimated tree without \(\rho\)-sample]]

* Classes

Here is a description of the classes that are provided by the package.

** =beast.evolution.speciation=

*** =TimTam=

This class extends the =TreeDistribution= and implements the tree prior. It uses
the [[*=TreeWithPointProcess=]] class to help it traverse the data.

*** =TimTamLogger=

This class implements =Loggable= and is used to record the prevalence at each
MCMC step.

** =beast.evolution.tree.birthdeath=

*** =EventType=

This class describes the kinds of events that can be observed under the TimTam
likelihood.

*** =BackwardsPointProcess= and =BackwardsSchedule=

These classes are really just aliases to =RealParameter= as a way to make their
meaning clearer. The =BackwardsPointProcess= stores the occurrence times and the
=BackwardsSchedule= is used to indicate when there was a scheduled sample.

*** =TreeWithBackwardsPointProcess=

This class extends the =CalculationNode= and provides functionality for computing
the times between observed events. This requires a tree, the origin time and a
=TraitSet= which is what we use to describe unsequenced observations.

* Structure

Figure [[example-dag]] shows an example of how =TimTam= and
=TreeWithBackwardsPointProcess= nodes might be used in a model, ie the nodes
represent =CalculationNode= objects. The darker blue nodes are from the classes
provided by this package. The =BackwardsPointProcess= node represents the times at
which there was an unsequenced observation and the =BackwardsSchedule= node
records when there was a scheduled sequenced sample. The =RootLength= is really a
=RealParameter= but this has not been given its own class yet.

#+name: example-dag
#+attr_org: :width 500
[[./example-dag.png]]
