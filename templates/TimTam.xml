<beast version='2.0' namespace='beast.app.beauti:beast.core:beast.evolution.branchratemodel:beast.evolution.speciation:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood:beast.evolution:beast.math.distributions'>

    <!-- tree priors -->
    <mergewith point='treePriorTemplates'>


        <subtemplate id='TimTam' class='beast.evolution.speciation.TimTam' mainid='TimTam.t:$(n)'>
            <![CDATA[
                   <input spec="beast.evolution.tree.birthdeath.BackwardsSchedule"
                   id="catastropheSchedule.t:$(n)"
                   value="0.0" />

                   <input spec="beast.evolution.tree.birthdeath.BackwardsSchedule"
                   id="disasterSchedule.t:$(n)"
                   value="0.0" />

                   <input spec="beast.evolution.tree.birthdeath.BackwardsCounts"
                   id="disasterCounts.t:$(n)"
                   value="1" />

                   <input spec="beast.evolution.tree.birthdeath.BackwardsPointProcess"
                   id="occurrenceTimes.t:$(n)"
                   value="0.0 0.1" />

                   <distribution id="TimTam.t:$(n)"
                   spec="beast.evolution.speciation.TimTam"
                   p="0.5"
                   catastropheTimes="@catastropheSchedule.t:$(n)"
                   points="@occurrenceTimes.t:$(n)"
                   disasterTimes="@disasterSchedule.t:$(n)"
                   disasterCounts="@disasterCounts.t:$(n)"
                   tree='@Tree.t:$(n)'>
            	     <lambda spec='parameter.RealParameter' id="birthRate.t:$(n)" value='2.0' lower='0' upper='100' />
                   <mu spec='parameter.RealParameter' id="deathRate.t:$(n)" value='0.5' lower='0' upper='100' />
                   <psi spec='parameter.RealParameter' id="samplingRate.t:$(n)" value='0.5' lower='0' upper='100' />
                   <omega spec='parameter.RealParameter' id="occurrenceRate.t:$(n)" value='0.5' lower='0' upper='100' />
                   <rootLength spec='parameter.RealParameter' id="rootLength.t:$(n)" value='0.1' lower='0' upper='100' />
                   <nu spec='parameter.RealParameter' id="nuProb.t:$(n)" value='0.5' lower='0' upper='1' />
                   </distribution>

                   <prior id='birthRatePrior.t:$(n)' x='@birthRate.t:$(n)'><distr spec="beast.math.distributions.Uniform" lower='0' upper='100'/></prior>
                   <prior id='deathRatePrior.t:$(n)' x='@deathRate.t:$(n)'><distr spec="beast.math.distributions.Uniform" lower='0' upper='100'/></prior>
                   <prior id='samplingRatePrior.t:$(n)' x='@samplingRate.t:$(n)'><distr spec="beast.math.distributions.Uniform" lower='0' upper='100'/></prior>
                   <prior id='occurrenceRatePrior.t:$(n)' x='@occurrenceRate.t:$(n)'><distr spec="beast.math.distributions.Uniform" lower='0' upper='100'/></prior>
                   <prior id='rootLengthPrior.t:$(n)' x='@rootLength.t:$(n)'><distr spec="beast.math.distributions.Uniform" lower='0' upper='100'/></prior>
                   <prior id='nuProbPrior.t:$(n)' x='@nuProb.t:$(n)'><distr spec="beast.math.distributions.Uniform" lower='0' upper='1'/></prior>

  		             <scale id='birthRateScaler.t:$(n)' spec='ScaleOperator' scaleFactor="0.75" weight="3" parameter="@birthRate.t:$(n)"/>
                   <input id='birthRateWalk.t:$(n)' spec="RealRandomWalkOperator" windowSize="0.1" useGaussian="true" weight="3" parameter="@birthRate.t:$(n)"/>

  		             <scale id='deathRateScaler.t:$(n)' spec='ScaleOperator' scaleFactor="0.75" weight="3" parameter="@deathRate.t:$(n)"/>
                   <input id='deathRateWalk.t:$(n)' spec="RealRandomWalkOperator" windowSize="0.1" useGaussian="true" weight="3" parameter="@deathRate.t:$(n)"/>

  		             <scale id='samplingRateScaler.t:$(n)' spec='ScaleOperator' scaleFactor="0.75" weight="3" parameter="@samplingRate.t:$(n)"/>
                   <input id='samplingRateWalk.t:$(n)' spec="RealRandomWalkOperator" windowSize="0.1" useGaussian="true" weight="3" parameter="@samplingRate.t:$(n)"/>

  		             <scale id='occurrenceRateScaler.t:$(n)' spec='ScaleOperator' scaleFactor="0.75" weight="3" parameter="@occurrenceRate.t:$(n)"/>
                   <input id='occurrenceRateWalk.t:$(n)' spec="RealRandomWalkOperator" windowSize="0.1" useGaussian="true" weight="3" parameter="@occurrenceRate.t:$(n)"/>

  		             <scale id='rootLengthScaler.t:$(n)' spec='ScaleOperator' scaleFactor="0.75" weight="3" parameter="@rootLength.t:$(n)"/>
                   <input id='rootLengthWalk.t:$(n)' spec="RealRandomWalkOperator" windowSize="0.1" useGaussian="true" weight="3" parameter="@rootLength.t:$(n)"/>

                   <input id='nuProbWalk.t:$(n)' spec="RealRandomWalkOperator" windowSize="0.1" useGaussian="true" weight="3" parameter="@nuProb.t:$(n)"/>

                   <input spec="beast.evolution.speciation.TimTamLogger" id="TimTamLogger.t:$(n)" />
                   ]]>

            <plate fragment="TreeOperators" var="m" range="TimTam" />

            <connect srcID='TimTam.t:$(n)' targetID='prior' inputName='distribution' if='inposterior(TimTam.t:$(n)) and inposterior(Tree.t:$(n)) and Tree.t:$(n)/estimate=true'>
                TimTam prior on tree t:$(n)
            </connect>
            <connect srcID='birthRate.t:$(n)' targetID='state' inputName='stateNode' if='inposterior(TimTam.t:$(n)) and inposterior(birthRate.t:$(n)) and birthRate.t:$(n)/estimate=true' />
            <connect srcID='deathRate.t:$(n)' targetID='state' inputName='stateNode' if='inposterior(TimTam.t:$(n)) and inposterior(deathRate.t:$(n)) and deathRate.t:$(n)/estimate=true' />
            <connect srcID='samplingRate.t:$(n)' targetID='state' inputName='stateNode' if='inposterior(TimTam.t:$(n)) and inposterior(samplingRate.t:$(n)) and samplingRate.t:$(n)/estimate=true' />
            <connect srcID='occurrenceRate.t:$(n)' targetID='state' inputName='stateNode' if='inposterior(TimTam.t:$(n)) and inposterior(occurrenceRate.t:$(n)) and occurrenceRate.t:$(n)/estimate=true' />
            <connect srcID='rootLength.t:$(n)' targetID='state' inputName='stateNode' if='inposterior(TimTam.t:$(n)) and inposterior(rootLength.t:$(n)) and rootLength.t:$(n)/estimate=true' />
            <connect srcID='nuProb.t:$(n)' targetID='state' inputName='stateNode' if='inposterior(TimTam.t:$(n)) and inposterior(nuProb.t:$(n)) and nuProb.t:$(n)/estimate=true' />

            <connect srcID='birthRatePrior.t:$(n)' targetID='prior' inputName='distribution' if='inposterior(TimTam.t:$(n)) and inposterior(birthRate.t:$(n)) and birthRate.t:$(n)/estimate=true'>
                birth rate of the TimTam model on partition t:$(n)
            </connect>
            <connect srcID='deathRatePrior.t:$(n)' targetID='prior' inputName='distribution' if='inposterior(TimTam.t:$(n)) and inposterior(deathRate.t:$(n)) and deathRate.t:$(n)/estimate=true'>
                death rate of the TimTam model on partition t:$(n)
            </connect>
            <connect srcID='samplingRatePrior.t:$(n)' targetID='prior' inputName='distribution' if='inposterior(TimTam.t:$(n)) and inposterior(samplingRate.t:$(n)) and samplingRate.t:$(n)/estimate=true'>
                sampling rate of the TimTam model on partition t:$(n)
            </connect>
            <connect srcID='occurrenceRatePrior.t:$(n)' targetID='prior' inputName='distribution' if='inposterior(TimTam.t:$(n)) and inposterior(occurrenceRate.t:$(n)) and occurrenceRate.t:$(n)/estimate=true'>
                occurrence rate of the TimTam model on partition t:$(n)
            </connect>
            <connect srcID='rootLengthPrior.t:$(n)' targetID='prior' inputName='distribution' if='inposterior(TimTam.t:$(n)) and inposterior(rootLength.t:$(n)) and rootLength.t:$(n)/estimate=true'>
                root length of the TimTam model on partition t:$(n)
            </connect>
            <connect srcID='nuProbPrior.t:$(n)' targetID='prior' inputName='distribution' if='inposterior(TimTam.t:$(n)) and inposterior(nuProb.t:$(n)) and nuProb.t:$(n)/estimate=true'>
                unsequenced scheduled sampling probability in TimTam model on partition t:$(n)
            </connect>

            <connect srcID='birthRateScaler.t:$(n)' targetID='mcmc' inputName='operator' if='inposterior(TimTam.t:$(n)) and inposterior(birthRate.t:$(n)) and birthRate.t:$(n)/estimate=true'>
                Scale birth rate of TimTam prior of tree t:$(n)
            </connect>

            <connect srcID='birthRateWalk.t:$(n)' targetID='mcmc' inputName='operator' if='inposterior(TimTam.t:$(n)) and inposterior(birthRate.t:$(n)) and birthRate.t:$(n)/estimate=true'>
                Random walk operator on birth rate of TimTam prior of tree t:$(n)
            </connect>

            <connect srcID='deathRateScaler.t:$(n)' targetID='mcmc' inputName='operator' if='inposterior(TimTam.t:$(n)) and inposterior(deathRate.t:$(n)) and deathRate.t:$(n)/estimate=true'>
                Scale death rate of TimTam prior of tree t:$(n)
            </connect>

            <connect srcID='deathRateWalk.t:$(n)' targetID='mcmc' inputName='operator' if='inposterior(TimTam.t:$(n)) and inposterior(deathRate.t:$(n)) and deathRate.t:$(n)/estimate=true'>
                Random walk operator on death rate of TimTam prior of tree t:$(n)
            </connect>

            <connect srcID='samplingRateScaler.t:$(n)' targetID='mcmc' inputName='operator' if='inposterior(TimTam.t:$(n)) and inposterior(samplingRate.t:$(n)) and samplingRate.t:$(n)/estimate=true'>
                Scale sampling rate of TimTam prior of tree t:$(n)
            </connect>

            <connect srcID='samplingRateWalk.t:$(n)' targetID='mcmc' inputName='operator' if='inposterior(TimTam.t:$(n)) and inposterior(samplingRate.t:$(n)) and samplingRate.t:$(n)/estimate=true'>
                Random walk operator on sampling rate of TimTam prior of tree t:$(n)
            </connect>

            <connect srcID='occurrenceRateScaler.t:$(n)' targetID='mcmc' inputName='operator' if='inposterior(TimTam.t:$(n)) and inposterior(occurrenceRate.t:$(n)) and occurrenceRate.t:$(n)/estimate=true'>
                Scale occurrence rate of TimTam prior of tree t:$(n)
            </connect>

            <connect srcID='occurrenceRateWalk.t:$(n)' targetID='mcmc' inputName='operator' if='inposterior(TimTam.t:$(n)) and inposterior(occurrenceRate.t:$(n)) and occurrenceRate.t:$(n)/estimate=true'>
                Random walk operator on occurrence rate of TimTam prior of tree t:$(n)
            </connect>

            <connect srcID='rootLengthScaler.t:$(n)' targetID='mcmc' inputName='operator' if='inposterior(TimTam.t:$(n)) and inposterior(rootLength.t:$(n)) and rootLength.t:$(n)/estimate=true'>
                Scale the root length of TimTam prior of tree t:$(n)
            </connect>

            <connect srcID='rootLengthWalk.t:$(n)' targetID='mcmc' inputName='operator' if='inposterior(TimTam.t:$(n)) and inposterior(rootLength.t:$(n)) and rootLength.t:$(n)/estimate=true'>
                Random walk operator on the root length of TimTam prior of tree t:$(n)
            </connect>

            <connect srcID='nuProbWalk.t:$(n)' targetID='mcmc' inputName='operator' if='inposterior(TimTam.t:$(n)) and inposterior(nuProb.t:$(n)) and nuProb.t:$(n)/estimate=true'>
                Random walk operator on the unsequenced scheduled sampling probability of TimTam prior of tree t:$(n)
            </connect>

            <connect srcID='birthRate.t:$(n)' targetID='tracelog' inputName='log' if='inposterior(TimTam.t:$(n)) and inposterior(birthRate.t:$(n)) and birthRate.t:$(n)/estimate=true' />
            <connect srcID='deathRate.t:$(n)' targetID='tracelog' inputName='log' if='inposterior(TimTam.t:$(n)) and inposterior(deathRate.t:$(n)) and deathRate.t:$(n)/estimate=true' />
            <connect srcID='samplingRate.t:$(n)' targetID='tracelog' inputName='log' if='inposterior(TimTam.t:$(n)) and inposterior(samplingRate.t:$(n)) and samplingRate.t:$(n)/estimate=true' />
            <connect srcID='occurrenceRate.t:$(n)' targetID='tracelog' inputName='log' if='inposterior(TimTam.t:$(n)) and inposterior(occurrenceRate.t:$(n)) and occurrenceRate.t:$(n)/estimate=true' />
            <connect srcID='rootLength.t:$(n)' targetID='tracelog' inputName='log' if='inposterior(TimTam.t:$(n)) and inposterior(rootLength.t:$(n)) and rootLength.t:$(n)/estimate=true' />
            <connect srcID='nuProb.t:$(n)' targetID='tracelog' inputName='log' if='inposterior(TimTam.t:$(n)) and inposterior(nuProb.t:$(n)) and nuProb.t:$(n)/estimate=true' />

            <connect srcID='TimTamLogger.t:$(n)' targetID='tracelog' inputName='log' if='inposterior(TimTam.t:$(n)) and inposterior(samplingRate.t:$(n)) and samplingRate.t:$(n)/estimate=true' />
            <connect srcID='TimTam.t:$(n)' targetID='TimTamLogger.t:$(n)' inputName='timtam' if='inposterior(TimTam.t:$(n)) and inposterior(samplingRate.t:$(n)) and samplingRate.t:$(n)/estimate=true' />

        </subtemplate>

    </mergewith>

</beast>
